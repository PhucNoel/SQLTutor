<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<f:event type="preRenderView" listener="#{freeEntryPageBean.devRedirect}" />
<h:head>
	<title>SQL Tutor</title>
	<ui:insert name="menu">
		<ui:include src="/samples/template-menubar.xhtml" />
	</ui:insert>
</h:head>
<h:body>

	<h:form id="freeEntryForm">
		<div>
			<p:outputLabel for="database" value="Database: " />
			<p:selectOneMenu id="database" value="#{userBean.selectedDatabase}"
				required="true" requiredMessage="Please select a database."
				effect="fade">
				<f:selectItems value="#{databaseSelectionBean.databases}"
					itemValue="#{databaseSelectionBean.databases}"
					itemLabel="#{databaseSelectionBean.databases}" />
			</p:selectOneMenu>
			
			<p:overlayPanel id="databasePanel" for="databaseButton" hideEffect="fade"> 
					<p:dataTable var="databaseTable"
						value="#{freeEntryPageBean.tables}">
						<p:column headerText="Table Names">
							<h:outputText value="#{databaseTable.tableName}" />
						</p:column>
						<p:column headerText="Column Names" style="width=200px; white-space: normal;">
							<h:outputText value="#{databaseTable.columnNames}" />
						</p:column>
					</p:dataTable>
			</p:overlayPanel> 
			
			<p:overlayPanel id="resultSetPanel" for="resultSetButton" hideEffect="fade"> 
					<p:dataTable id="resultsTable" var="row"
						value="#{freeEntryPageBean.queryResult.data}">
						<p:columns value="#{freeEntryPageBean.queryResult.columnNames}"
							var="column" columnIndexVar="columnIndex">
							<f:facet name="header">
									#{column}
								</f:facet>
								#{row[columnIndex]}
							</p:columns>
					</p:dataTable>
			</p:overlayPanel> 
	
			<p:commandButton id="databaseButton" value="Show Schema" />
			<p:commandButton id="resultSetButton" value="Show Result Set" />
		</div><div>
			<p:messages />
			<p:panelGrid columns="2">
				<f:facet name="header">  
				    Add Query
				</f:facet>
				
				<p:outputLabel for="query" value="Enter Query: " />
				<p:inputTextarea rows="3" cols="35" id="query" reRender="results"
					styleClass="unresizable" value="#{freeEntryPageBean.query}" />
					
				<h:outputLabel for="userDescription" value="English description: " />
				<p:inputTextarea rows="6" id="userDescription" required="true" 
						value="#{freeEntryPageBean.userDescription}" />
				
				<f:facet name="footer">
					<p:commandButton id="addQueryButton"
						action="#{freeEntryPageBean.addQuery}"
						update="freeEntryForm" 
						value="Add" icon="ui-icon-check" style="margin:0"/>
				</f:facet> 
			</p:panelGrid>
			<p:dataTable id="userQueriesTable" var="query" 
					value="#{freeEntryPageBean.userQueries}">
				<p:column headerText="Schema">
					<h:outputText value="#{query.schema}" />
				</p:column>
				<p:column headerText="Query">
					<h:outputText value="#{query.query}" />
				</p:column>
				<p:column headerText="English">
					<h:outputText value="#{query.userDescription}" />
				</p:column>
			</p:dataTable>
      	</div>
	</h:form>
</h:body>
</html>