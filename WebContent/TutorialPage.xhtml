<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<f:event type="preRenderView" listener="#{userBean.homepageRedirect}" />
<h:head>
	<title>SQL Tutor</title>
	<ui:insert name="menu">
		<ui:include src="/samples/template-menubar.xhtml" />
	</ui:insert>
</h:head>
<h:body style="height:1000px;width:1400px;margin-left:20px">
	<h:form id="form">
		<div style="position:absolute;width:700;height:500;top:auto;left:20">
			<h2>Question:</h2>
			<h:outputText id="question" value="#{tutorialBean.question}" />
			<br/>
			<h2>Database:</h2>
			<p:dataTable var="databaseTable"
				value="#{tutorialBean.tables}">
				<p:column headerText="Table Names" width="100">
					<h:outputText value="#{databaseTable.tableName}" />
				</p:column>
				<p:column headerText="Column Names" width="400" style="white-space: normal;">
					<h:outputText value="#{databaseTable.columns}" />
				</p:column>
			</p:dataTable>

			<h2>Query input:</h2>
			<p:inputTextarea rows="5" cols="30" id="query" reRender="results" style="resize:none"
				autoResize="false" value="#{tutorialBean.query}" />
			<br/>
			<p:commandButton id="try" value="Try Query"
				action="#{tutorialBean.processSQL}" 
				update="form" />
			<p:commandButton id="next" value="Next Question"
				action="#{tutorialBean.nextQuestion}"
				update="form"/>
		</div>

		<div style="position:absolute;width:700;height:500;top:auto;left:730">
			<h2>Query Result:</h2>
			<p:dataTable id="resultsTable" var="row" scrollable="true" scrollHeight="200"
				value="#{tutorialBean.queryResult.data}" >
				<p:columns value="#{tutorialBean.queryResult.columns}" style="white-space: normal;"
					var="column" columnIndexVar="columnIndex">
					<f:facet name="header">
						#{column}
					</f:facet>
					#{row[columnIndex]}
				</p:columns>
			</p:dataTable>
			<h2>Feedback:</h2>
			<ui:param name="queryIsCorrectFeedback" value="#{tutorialBean.resultSetFeedback}"/>
			<ui:param name="queryisIncorrectFeedback" value="#{tutorialBean.resultSetFeedback} #{tutorialBean.feedbackNLP}"/>
			<h:outputText id="resultSetFeedback" value="#{tutorialBean.getQueryIsCorrect() ? queryIsCorrectFeedback : queryisIncorrectFeedback}"
				style="width: 700px!important; display:block!important;" escape="false"/>
			<br/>
			<h:outputText value="Your result should resemble this example:" rendered="#{!tutorialBean.getQueryIsCorrect()}"/>
			<p:commandButton id="answerButton" value="Example Answer" rendered="#{!tutorialBean.getQueryIsCorrect()}"/>
			<p:overlayPanel id="answerPanel" for="answerButton" hideEffect="fade"> 
				<p:dataTable id="answerTable" var="row" scrollable="true" scrollHeight="200"
					value="#{tutorialBean.answerResult.data}" >
					<p:columns value="#{tutorialBean.answerResult.columns}" style="white-space: normal;"
						var="column" columnIndexVar="columnIndex">
						<f:facet name="header">
							#{column}
						</f:facet>
						#{row[columnIndex]}
					</p:columns>
				</p:dataTable>
			</p:overlayPanel>
			<br/>
			<br/>
			<br/>
			<h:outputText style="width: 700px!important; display:block!important;" escape="false" rendered="#{!tutorialBean.getQueryIsCorrect()}"
				value="Did this feedback help you? Did the question that we determined you meant to answer make sense? Please leave us anonymous feedback:"/>
			<p:commandButton icon="ui-icon-check" onclick="PF('feedback_dlg').show();" value="Submit Feedback" 
				rendered="#{!tutorialBean.getQueryIsCorrect()}" update=":feedbackForm:feedbackPanel"/>
		</div>
	</h:form>
	<p:dialog id="feedbackDialog" header="Anonymous Feedback" widgetVar="feedback_dlg" 
		modal="true" width="400" resizable="false" appendTo="@(body)">  
		<h:form id="feedbackForm">
			<p:panel id="feedbackPanel">
				<h:outputText value="Please rate our English generation:"/>
				<br/><br/>
				<h:outputText value="#{tutorialBean.feedbackNLP}"/>
				<br/><br/>
				<p:rating/>
				<br/><br/>
				<h:outputText value="Also, please describe how we might improve our feedback generation:"/>
				<p:inputTextarea rows="3" cols="44" id="source" style="resize:none" 
					value="#{tutorialBean.userFeedback}" autoResize="false"/>
				<p:messages id="messages"/>
			</p:panel>
			<p:panel>
				<p:captcha label="Captcha" theme="white" required="true" 
					requiredMessage="Captcha is required." validatorMessage="Captcha text did not match." secure="true"/>
			</p:panel>
			<br/>
			<p:commandButton id="submitFeedback" value="Submit Feedback" icon="ui-icon-check" style="margin:0"
				action="#{tutorialBean.submitFeedback}" 
				update="feedbackPanel" oncomplete="Recaptcha.reload()" onerror="Recaptcha.reload()"/>	
		</h:form>
	</p:dialog>
</h:body>
</html>